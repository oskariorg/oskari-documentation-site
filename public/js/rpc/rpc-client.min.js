!function o(r,i,s){function a(n,e){if(!i[n]){if(!r[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);throw(t=new Error("Cannot find module '"+n+"'")).code="MODULE_NOT_FOUND",t}t=i[n]={exports:{}},r[n][0].call(t.exports,function(e){return a(r[n][1][e]||e)},t,t.exports,o,r,i,s)}return i[n].exports}for(var c="function"==typeof require&&require,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,n,t){var o,r;o=this,r=function(){"use strict";var u,d,E;function O(e){return Array.isArray?Array.isArray(e):-1!=e.constructor.toString().indexOf("Array")}function e(e){try{var n=JSON.parse(e.data);if("object"!=typeof n||null===n)throw"malformed"}catch(e){return}var t,o,r,i,s=e.source,a=e.origin;if("string"==typeof n.method&&(i=2==(r=n.method.split("::")).length?(t=r[0],r[1]):n.method),void 0!==n.id&&(o=n.id),"string"==typeof i){var c=!1;if(d[a]&&d[a][t])for(var l=0;l<d[a][t].length;l++)if(d[a][t][l].win===s){d[a][t][l].handler(a,i,n),c=!0;break}if(!c&&d["*"]&&d["*"][t])for(l=0;l<d["*"][t].length;l++)if(d["*"][t][l].win===s){d["*"][t][l].handler(a,i,n);break}}else void 0!==o&&E[o]&&E[o](a,i,n)}return u=Math.floor(1000001*Math.random()),d={},E={},window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent&&window.attachEvent("onmessage",e),{build:function(w){function m(e){if(w.debugOutput&&window.console&&window.console.log){try{"string"!=typeof e&&(e=JSON.stringify(e))}catch(e){}window.console.log("["+o+"] "+e)}}if(!window.postMessage)throw"jschannel cannot run this browser, no postMessage";if(!window.JSON||!window.JSON.stringify||!window.JSON.parse)throw"jschannel cannot run this browser, no JSON parsing/serialization";if("object"!=typeof w)throw"Channel build invoked without a proper object argument";if(!w.window||!w.window.postMessage)throw"Channel.build() called without a valid window argument";if(window===w.window)throw"target window is same as present window -- not allowed";var e,n=!1;if("string"==typeof w.origin&&("*"===w.origin?n=!0:null!==(e=w.origin.match(/^https?:\/\/(?:[-a-zA-Z0-9_\.])+(?::\d+)?/))&&(w.origin=e[0].toLowerCase(),n=!0)),!n)throw"Channel.build() called with an invalid origin";if(void 0!==w.scope){if("string"!=typeof w.scope)throw"scope, when specified, must be a string";if(1<w.scope.split("::").length)throw"scope may not contain double colons: '::'"}else w.scope="__default";function l(e,n,t){if("function"==typeof w.gotMessageObserver)try{w.gotMessageObserver(e,t)}catch(e){m("gotMessageObserver() raised an exception: "+e.toString())}if(t.id&&n){v[t.id]={};var o=(d=t.id,h=t.callbacks||[],g=p=!1,{origin:e,invoke:function(e,n){if(!v[d])throw"attempting to invoke a callback of a nonexistent transaction: "+d;for(var t=!1,o=0;o<h.length;o++)if(e===h[o]){t=!0;break}if(!t)throw"request supports no such callback '"+e+"'";k({id:d,callback:e,params:n})},error:function(e,n){if(g=!0,!v[d])throw"error called for nonexistent message: "+d;delete v[d],k({id:d,error:e,message:n})},complete:function(e){if(g=!0,!v[d])throw"complete called for nonexistent message: "+d;delete v[d],k({id:d,result:e})},delayReturn:function(e){return p="boolean"==typeof e?!0===e:p},completed:function(){return g}});if(y[n])try{if(t.callbacks&&O(t.callbacks)&&0<t.callbacks.length)for(var r=0;r<t.callbacks.length;r++){for(var i=t.callbacks[r],s=t.params,a=i.split("/"),c=0;c<a.length-1;c++){var l=a[c];"object"!=typeof s[l]&&(s[l]={}),s=s[l]}s[a[a.length-1]]=function(){var n=i;return function(e){return o.invoke(n,e)}}()}var f=y[n](o,t.params);o.delayReturn()||o.completed()||o.complete(f)}catch(n){var u="runtime_error",f=null;if("string"==typeof n?f=n:"object"==typeof n&&(n instanceof Error?(u=n.constructor.name,f=n.message):n&&O(n)&&2==n.length?(u=n[0],f=n[1]):"string"==typeof n.error&&(u=n.error,n.message?"string"==typeof n.message?f=n.message:n=n.message:f="")),null===f)try{void 0===(f=JSON.stringify(n))&&(f=n.toString())}catch(e){f=n.toString()}o.error(u,f)}else o.error("method_not_found","No method '"+n+"' was (yet) bound by the provider")}else t.id&&t.callback?b[t.id]&&b[t.id].callbacks&&b[t.id].callbacks[t.callback]?b[t.id].callbacks[t.callback](t.params):m("ignoring invalid callback, id:"+t.id+" ("+t.callback+")"):t.id?b[t.id]?(t.error?b[t.id].error&&b[t.id].error(t.error,t.message):void 0!==t.result?b[t.id].success(t.result):b[t.id].success(),delete b[t.id],delete E[t.id]):m("ignoring invalid response: "+t.id):n&&y[n]&&y[n]({origin:e},t.params);var d,h,p,g}var o=function(){for(var e="",n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t=0;t<5;t++)e+=n.charAt(Math.floor(Math.random()*n.length));return e}(),y={},b={},v={},r=!1,i=[],s=[];!function(t,e,n,o){function r(e){for(var n=0;n<e.length;n++)if(e[n].win===t)return!0;return!1}var i=!1;if("*"===e){for(var s in d)if(d.hasOwnProperty(s)&&"*"!==s&&"object"==typeof d[s][n]&&(i=r(d[s][n])))break}else!(i=d["*"]&&d["*"][n]?r(d["*"][n]):i)&&d[e]&&d[e][n]&&(i=r(d[e][n]));if(i)throw"A channel is already bound to the same window which overlaps with origin '"+e+"' and has scope '"+n+"'";"object"!=typeof d[e]&&(d[e]={}),"object"!=typeof d[e][n]&&(d[e][n]=[]),d[e][n].push({win:t,handler:o})}(w.window,w.origin,w.scope,l);function f(e){return[w.scope,e].join("::")}function a(e,n){var t;e=[].concat(e);for(var o=0;o<e.length;o++)n[t=e[o].toString()]=function(o){return function(e,n,t){n?c.call({method:o,params:e,success:n,error:t}):c.notify({method:o,params:e})}}(t)}var k=function(e,n){if(!e)throw"postMessage called with null message";if(n||r){if("function"==typeof w.postMessageObserver)try{w.postMessageObserver(w.origin,e)}catch(e){m("postMessageObserver() raised an exception: "+e.toString())}m("post message: "+JSON.stringify(e)+" with origin "+w.origin),w.window.postMessage(JSON.stringify(e),w.origin)}else m("queue message: "+JSON.stringify(e)),i.push(e)},c={remote:{},unbind:function(e,n){if(y[e]){if(!delete y[e])throw"can't delete method: "+e;return w.publish&&!n&&(r?c.notify({method:"__unbind",params:e}):s.push({action:"unbind",method:e})),!0}return!1},bind:function(e,n,t){if(!e||"string"!=typeof e)throw"'method' argument to bind must be string";if(!n||"function"!=typeof n)throw"callback missing from bind params";if(y[e])throw"method '"+e+"' is already bound!";return y[e]=n,w.publish&&!t&&(r?c.notify({method:"__bind",params:e}):s.push({action:"bind",method:e})),this},call:function(e){if(!e)throw"missing arguments to call function";if(!e.method||"string"!=typeof e.method)throw"'method' argument to call must be string";if(!e.success||"function"!=typeof e.success)throw"'success' callback missing from call";function r(e,n){if(0<=a.indexOf(n))throw"params cannot be a recursive data structure";if(n&&a.push(n),"object"==typeof n)for(var t in n){var o;n.hasOwnProperty(t)&&(o=e+(e.length?"/":"")+t,"function"==typeof n[t]?(i[o]=n[t],s.push(o),delete n[t]):"object"==typeof n[t]&&r(o,n[t]))}}var i={},s=[],a=[];r("",e.params);var n,t,o,c={id:u,method:f(e.method),params:e.params};s.length&&(c.callbacks=s),e.timeout&&(n=u,t=e.timeout,o=f(e.method),window.setTimeout(function(){b[n]&&(b[n].error&&b[n].error("timeout_error","timeout ("+t+"ms) exceeded on method '"+o+"'"),delete b[n],delete E[n])},t)),b[u]={callbacks:i,error:e.error,success:e.success},E[u]=l,u++,k(c)},notify:function(e){if(!e)throw"missing arguments to notify function";if(!e.method||"string"!=typeof e.method)throw"'method' argument to notify must be string";k({method:f(e.method),params:e.params})},destroy:function(){!function(e,n,t){for(var o=d[n][t],r=0;r<o.length;r++)o[r].win===e&&o.splice(r,1);0===d[n][t].length&&delete d[n][t]}(w.window,w.origin,w.scope),window.removeEventListener?window.removeEventListener("message",l,!1):window.detachEvent&&window.detachEvent("onmessage",l),r=!1,y={},v={},b={},w.origin=null,i=[],m("channel destroyed"),o=""}};return c.bind("__ready",function(e,n){if(m("ready msg received"),r&&!w.reconnect)throw"received ready message while in ready state.";r=!0,o.length<6&&("publish-request"===n.type?o+="-R":o+="-L"),m("ready msg accepted."),"publish-request"===n.type&&c.notify({method:"__ready",params:{type:"publish-reply",publish:s}});for(var t=0;t<n.publish.length;t++)"bind"===n.publish[t].action?a([n.publish[t].method],c.remote):delete c.remote[n.publish[t].method];for(w.reconnect||c.unbind("__ready",!0);i.length;)k(i.splice(0,1)[0]);s=[],"function"==typeof w.onReady&&w.onReady(c)},!0),c.bind("__bind",function(e,n){a([n],c.remote)},!0),c.bind("__unbind",function(e,n){c.remote[n]&&delete c.remote[n]},!0),w.remote&&a(w.remote,c.remote),setTimeout(function(){0<o.length&&k({method:f("__ready"),params:{type:"publish-request",publish:s}},!0)},0),c}}},"object"==typeof t?n.exports=r():"function"==typeof define&&define.amd?define([],function(){return o.Channel=r()}):o.Channel=r()},{}],2:[function(e,n,t){var o,r;o=this,r=function(t){"use strict";function i(e){return"function"==typeof e}return{VERSION:"2.1.0",connect:function(e,n){if(null==t)throw new Error("JSChannel not found.");if(null==e)throw new TypeError("Missing target element.");if(!e.contentWindow)throw new TypeError("Target is missing contentWindow.");if(null==n)throw new TypeError("Missing origin.");if(0!==n.indexOf("http"))throw new TypeError("Invalid origin: "+n+".");function i(){throw s.log("Error",arguments),new Error("RPC call failed!")}var o=!1,r=[],s={enableDebug:function(e){0},log:function(){window.console&&window.console.log&&window.console.log.apply(window.console,arguments)}};s.isReady=function(){return o},s.onReady=function(e){"function"==typeof e&&(o?e():r.push(e))},s.destroy=function(){l.destroy()};var a={};s.handleEvent=function(r,e){if(!r)throw new Error("Event name not specified");if("function"!=typeof e)throw new Error("Handler is not a function");a[r]||(a[r]=[]),a[r].push(e),1===a[r].length&&(l.bind(r,function(e,n){for(var t=a[r],o=0;o<t.length;++o)t[o](n)}),l.call({method:"handleEvent",params:[r,!0],success:function(){},error:i}))},s.unregisterEventHandler=function(e,n){if(!e)throw new Error("Event name not specified");var t=a[e];if(t&&t.length){for(var o=[],r=0;r<t.length;++r)t[r]!==n&&o.push(t[r]);(a[e]=o).length||(l.unbind(e),l.call({method:"handleEvent",params:[e,!1],success:function(){},error:i}))}else window.console&&window.console.log&&console.log("Trying to unregister listener, but there are none for event: "+e)},s.postRequest=function(e,n,t){l.call({method:"postRequest",params:[e,n],success:function(){},error:t||i})};var c;s.isSupported=function(e,n){if("function"==typeof e&&(n=e,e=null),"function"!=typeof n&&(n=function(e){s.log("Callback function for isSupported() not provided. Client supported: "+e)}),!o)throw new Error("Map not connected yet");var t;c?(t=c.clientSupported,n(t=e?t&&c.version===e:t)):n(!1)};var l=t.build({window:e.contentWindow,origin:n,scope:"Oskari",onReady:function(){l.call({method:"getSupportedFunctions",success:function(e){for(var n in e)e.hasOwnProperty(n)&&function(o){s[o]=function(e,n,t){"getInfo"===o&&(t=n,n=e,e=["2.1.0"]),"function"==typeof e&&(t=n,n=e,e=[]),l.call({method:o,params:e,success:n,error:t||i})}}(n);function t(e){o=!0;for(var n=0;n<r.length;++n)r[n](e)}"function"==typeof s.getInfo?s.getInfo(function(e){t({clientSupported:(c=e).clientSupported,version:c.version})}):t()},error:function(){throw new Error("Couldn't setup allowed functions")}})}});return s},synchronizerFactory:function(t,o){if(!t)throw new TypeError("Missing RPC channel");if(!Array.isArray(o))throw new TypeError('Argument "handlers" must be Array');for(var e=0;e<o.length;++e)if(!i(o[e].init)||!i(o[e].synchronize))throw new TypeError("Handlers must implement methods init(channel) & synchronize(channel, state)");var n=null;function r(e){for(var n=0;n<o.length;++n)o[n].synchronize(t,e)}return t.onReady(function(){for(var e=0;e<o.length;++e)o[e].init(t);n&&r(n)}),{synchronize:function(e){n=e,t.isReady&&r(e)},destroy:function(){for(var e=0;e<o.length;++e)i(o[e].destroy)&&o[e].destroy();t.destroy()}}}}},"function"==typeof define&&define.amd?define(["jschannel"],r):"object"==typeof n&&n.exports?n.exports=r(e("jschannel")):o.OskariRPC=r(o.Channel)},{jschannel:1}],3:[function(e,n,t){window.OskariRPC=e("oskari-rpc")},{"oskari-rpc":2}]},{},[3]);